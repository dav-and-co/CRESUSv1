{# templates/beneficiaire/insertDemande.html.twig #}

{% extends 'interne/partial/intBase.html.twig' %}

{% block metatitle %}
    - insert demande
{% endblock %}


{% block main %}

<section class="onedemande">
    <h1>Demande : <span>{{ demande.typeDemande.libelleDemande }} - {{ demande.positionDemande.libellePosition }}</span></h1>
    <h5>Origine et date de la demande: {{ demande.origine.libelleOrigine }}  {{ demande.complementOrigine }} - {{ demande.createdAt|date('d/m/Y') }}</h5>
    <h3>
        {% if demande.beneficiaires|length == 1 %}
            Bénéficiaire
            <a href="{{ path('insertBeneficiaire', {id: demande.id}) }}" class="btn btn-success">+</a>
        {% elseif demande.beneficiaires|length == 2 %}
            Bénéficiaires
        {% endif %}
    </h3>
    <div class="affichage-groupe">
        {% if demande.beneficiaires|length == 1 %}
            {% for beneficiaire in demande.beneficiaires %}
            <div class="affichage-detail">
                    <p> <span>{{ beneficiaire.civiliteBeneficiaire }} {{ beneficiaire.nomBeneficiaire }} {{ beneficiaire.prenomBeneficiaire }},</span>
                        né(e) le
                        {% if beneficiaire.ddnBeneficiaire %}
                            {{ beneficiaire.ddnBeneficiaire|date('d/m/Y') }}
                        {% else %}
                            Non renseigné
                        {% endif %}
                        <a href="{{ path('updatebeneficiaire', {'id': beneficiaire.id, 'redirect': app.request.uri}) }}" class="btn-over">
                            <i class="fa-solid fa-file-pen fa-lg" style="color:#2a7cf6"></i>
                        </a>
                    </p>

                    <p> mail : <span>{{ beneficiaire.mailBeneficiaire }}</span> - tél : <span>{{ beneficiaire.telephoneBeneficiaire }} </span> </p>
                    <p>   {{  beneficiaire.libelleProf.libelleProf }} - profession : {{ beneficiaire.professionBeneficiaire }}  </p>
                </div>
            {% endfor %}
        {% elseif demande.beneficiaires|length == 2 %}
            {% for beneficiaire in demande.beneficiaires %}
                <div class="affichage-detail">
                    <p>
                        <a href="{{ path('removeBeneficiaireFromDemande',{demandeId: demande.id, beneficiaireId: beneficiaire.id})}}"
                           class="btn-remove-beneficiaire"
                           onclick="return confirm('Êtes-vous sûr de vouloir supprimer ce bénéficiaire de la demande ?');">
                            <i class="fa fa-minus-circle"></i>
                        </a>
                        <span class="retrait">{{ beneficiaire.civiliteBeneficiaire }} {{ beneficiaire.nomBeneficiaire }} {{ beneficiaire.prenomBeneficiaire }},</span>
                        né(e) le
                        {% if beneficiaire.ddnBeneficiaire %}
                            {{ beneficiaire.ddnBeneficiaire|date('d/m/Y') }}
                        {% else %}
                            Non renseigné
                        {% endif %}
                        <a href="{{ path('updatebeneficiaire', {'id': beneficiaire.id, 'redirect': app.request.uri}) }}" class="btn-over">
                            <i class="fa-solid fa-file-pen fa-lg" style="color:#2a7cf6"></i>
                        </a>
                    </p>
                    <p> mail : <span>{{ beneficiaire.mailBeneficiaire }}</span> - tél : <span>{{ beneficiaire.telephoneBeneficiaire }} </span> </p>
                    <p>{{ beneficiaire.libelleProf.libelleProf }} - profession : {{ beneficiaire.professionBeneficiaire }}</p>
                </div>
            {% endfor %}
        {% endif %}
    </div>
       <div class="affichage-groupe fondbleu">
           <div class="affichage-detail titre specdemande">
                <h3> Données de la demande
                    <a href="{{ path('modif_demande', {id: demande.id}) }}" class="btn-over">
                        <i class="fa-solid fa-file-pen fa-sm" style="color:#2a7cf6"></i>
                    </a>
                </h3>
                <p>Cause : {{ demande.causeBesoin }}</p>
           </div>
            <div class="affichage-detail specdemande">
                 <p><span>Adresse</span></p>
                    <p>{{ demande.adresse1Demande }}</p>
                    <p>{{ demande.adresse2Demande }}</p>
                    <p>{{ demande.cpDemande }} {{ demande.villeDemande }}</p>
            </div>
            <div class="affichage-detail specdemande">
                <p>Logement : {{ demande.situationLogt }}</p>
                <p>enfants à charge : {{ demande.nbEnfant }}</p>
                <p>patrimoine :{{ demande.patrimoine }}</p>
            </div>
           <div class="affichage-detail specdemande1 fin">
               <h6>
                   Revenus
                   <a href="{{ path('insertRevenu', {id: demande.id}) }}" class="ajout btn btn-success"> <i class="fa-solid fa-plus circle" style="color: white;"></i></a>
               </h6>
               {% for revenu in demande.revenus %}
               <p>{{ revenu.typeRevenu.libelleRevenu }} :
                   {{ revenu.montantMensuel }}
                   <a href="{{ path('modif_revenu', {id: revenu.id}) }}" class="btn-over">
                       <i class="fa-solid fa-file-pen fa-sm" style="color:#2a7cf6"></i>
                   </a>
               </p>
                 {% endfor %}
           </div>
           <div class="affichage-detail specdemande1 fin">
               <h6>
                   Charges
                   <a href="{{ path('insertCharge', {id: demande.id}) }}" class="ajout btn btn-success"> <i class="fa-solid fa-plus circle" style="color: white;"></i></a>
               </h6>
               {% for charge in demande.charges %}
                   <p>{{ charge.typeCharge.libelleCharge }} :
                       {{ charge.montantMensuel }}
                       <a href="{{ path('modif_charge', {id: charge.id}) }}" class="btn-over">
                           <i class="fa-solid fa-file-pen fa-sm" style="color:#2a7cf6"></i>
                       </a>
                   </p>
               {% endfor %}
           </div>
           <div class="affichage-detail specdemande2 fin">
               <h6>
                   Dettes et crédits
                   <a href="{{ path('insertDette', {id: demande.id}) }}" class="ajout btn btn-success"> <i class="fa-solid fa-plus circle" style="color: white;"></i></a>
               </h6>
               {% for dette in demande.dettes %}
                   <p>{{ dette.typeDette.libelledette }} -
                       <span> {{ dette.organisme }} </span>
                       mensualité : {{ dette.mensualite }} -
                       montant du : {{ dette.montantDu }}
                       <a href="{{ path('modif_dette', {id: dette.id}) }}" class="btn-over">
                           <i class="fa-solid fa-file-pen fa-sm" style="color:#2a7cf6"></i>
                       </a>
                   </p>
               {% endfor %}
           </div>
       </div>
    <div class="affichage-groupe fondbleu">
        <div>
              <form action="{{ path('MAJcommentaires', {id: demande.id}) }}" method="post">
                     <textarea class="affichage-detail commentaires " name="commentaires" rows="5" cols="50" >{{ demande.commentaires }}</textarea>
                    <button class="btn btn-primary" type="submit">Enregistrer les commentaires</button>
              </form>
        </div>
        <div class="affichage-detailbis specdemande">
            <div class="affichage-fin">
                <h6>
                    Evolution du dossier
                    <a href="{{ path('insert_evoldoss', {id: demande.id}) }}" class="ajout btn btn-success"> <i class="fa-solid fa-plus circle" style="color: white;"></i></a>
                </h6>
                {% for avancement in demande.historiqueAvcts %}
                    <p> <span> {{ avancement.createdAt|date('d/m/Y') }} </span> - {{ avancement.avancement.libelleAvancement }} - {{ avancement.commentairesAvct }}</p>
                {% endfor %}
            </div>
            <div  class="affichage-fin">
                <h6>
                    Historique des RDV
                    <a href="{{ path('insertRevenu', {id: demande.id}) }}" class="ajout btn btn-success"> <i class="fa-solid fa-plus circle" style="color: white;"></i></a>
                </h6>
                {% for rdv in demande.RendezVous %}
                    <p> <span> {{ rdv.dateAt|date('d/m/Y') }} - {{ rdv.heureAt|date('H:i') }}</span> - {{ rdv.Site.nomSite }} </p>
                {% endfor %}
            </div>
        </div>
    </div>
</section>

{% endblock %}

{% block javascript %}
<script src="JS/buttonpopup.js"></script>
{% endblock %}